---
layout: default
title: "图片引用格式转换规则"
date: 2025-01-27 12:00:00 +0800
categories:
---

# 图片引用格式转换规则

本文档详细记录了 Obsidian 和 Jekyll 项目之间图片引用格式的转换规则，用于 GitHub Actions 自动同步系统的参考。

## 概述

自动同步系统会将 Obsidian 中的图片引用格式转换为 Jekyll 兼容的格式，同时处理图片文件的复制、重命名和目录组织。

## Obsidian 图片引用格式

### 支持的引用格式

1. **Wiki 链接格式**（推荐）
   ```markdown
   ![image.png](/assets/images/posts/2025/2025-01-27-图片引用格式转换规则/2025-01-27-图片引用格式转换规则_001.png)
   ![screenshot.jpg](/assets/images/posts/2025/2025-01-27-图片引用格式转换规则/2025-01-27-图片引用格式转换规则_002.jpg)
   ![diagram.svg](/assets/images/posts/2025/2025-01-27-图片引用格式转换规则/2025-01-27-图片引用格式转换规则_003.svg)
   ```

2. **相对路径格式**
   ```markdown
   ![描述](/assets/images/posts/2025/2025-01-27-图片引用格式转换规则/2025-01-27-图片引用格式转换规则_006.png)
   ![描述](/assets/images/posts/2025/2025-01-27-图片引用格式转换规则/2025-01-27-图片引用格式转换规则_007.jpg)
   ```

3. **绝对路径格式**
   ```markdown
   ![描述](/LeonLi/images/image.png)
   ```

### Obsidian 图片存储规范

- **推荐存储位置**: `笔记文件名/attachments/` 目录
- **命名规则**: `笔记名称-00x.图片格式`
- **示例结构**:
  ```
  LeonLi/Knowledge/Programming/Angular/
  ├── Angular Tutorial.md
  └── Angular Tutorial/
      └── attachments/
          ├── Angular Tutorial-001.png
          ├── Angular Tutorial-002.jpg
          └── Angular Tutorial-003.gif
  ```

## Jekyll 图片引用格式

### 标准引用格式

```markdown
![alt-text](/assets/images/posts/YYYY/article-directory/filename)
```

### 路径组成规则

1. **基础路径**: `/assets/images/posts/`
2. **年份目录**: `YYYY/` (文章发布年份)
3. **文章目录**: `article-directory/` (文章目录名)
4. **图片文件名**: `article-title_NNN.ext` (重命名后的文件名)

## 转换规则详解

### 1. 图片文件查找规则

系统按以下优先级查找图片文件：

1. **精确匹配**: 在 Obsidian 仓库中查找完全匹配的文件名
2. **目录搜索**: 递归搜索所有子目录
3. **扩展名匹配**: 支持 png, jpg, jpeg, gif, svg, webp 等格式
4. **大小写忽略**: 忽略文件名大小写差异

### 2. 目录命名规则

#### 文章目录生成

- **格式**: `YYYY-MM-DD-sanitized-title`
- **日期提取**: 优先级 YAML front matter > 文件名模式 > 当前日期
- **标题处理**: 
  - 提取第一个 `# 标题` 或 YAML 中的 title
  - 清理特殊字符，转换空格为连字符
  - 保留中文字符

#### 示例转换

| Obsidian 文件名 | 提取信息 | Jekyll 目录名 |
|----------------|----------|---------------|
| `test-blog-post-with-images.md` | 日期: 2025-01-27<br>标题: "图片交换测试" | `2025-01-27-图片交换测试` |
| `Angular Tutorial.md` | 日期: 2024-03-15<br>标题: "Angular Tutorial" | `2024-03-15-Angular-Tutorial` |

### 3. 图片文件重命名规则

#### 命名格式

```
{article-title}_{NNN}.{ext}
```

- **article-title**: 文章标题（清理后）
- **NNN**: 3位数字编号（001, 002, 003...）
- **ext**: 原始文件扩展名

#### 编号规则

- 起始编号: `001`
- 递增规则: 按图片在文章中出现的顺序
- 格式化: `padStart(3, '0')` 确保3位数字

#### 示例重命名

| 原始文件名 | 文章标题 | 编号 | 重命名后 |
|-----------|----------|------|----------|
| `screenshot.png` | "图片交换测试" | 001 | `图片交换测试_001.png` |
| `diagram.jpg` | "Angular Tutorial" | 002 | `Angular-Tutorial_002.jpg` |
| `example.gif` | "技术分享" | 003 | `技术分享_003.gif` |

### 4. 路径转换示例

#### 完整转换流程

**步骤1: Obsidian 原始引用**
```markdown
# 图片交换测试

这是一个测试图片：
![screenshot.png](/assets/images/posts/2025/2025-01-27-图片引用格式转换规则/2025-01-27-图片引用格式转换规则_004.png)

另一个图片：
![diagram.jpg](/assets/images/posts/2025/2025-01-27-图片引用格式转换规则/2025-01-27-图片引用格式转换规则_005.jpg)


```

**步骤2: 系统处理**
- 检测到博客标签
- 提取文章信息: 标题="图片交换测试", 日期="2025-01-27"
- 生成目录名: `2025-01-27-图片交换测试`
- 查找图片文件: `screenshot.png`, `diagram.jpg`
- 重命名图片: `图片交换测试_001.png`, `图片交换测试_002.jpg`

**步骤3: Jekyll 转换结果**
```markdown
---
layout: default
title: "图片交换测试"
date: 2025-01-27 12:00:00 +0800
categories:
---

# 图片交换测试

这是一个测试图片：
![screenshot](/assets/images/posts/2025/2025-01-27-图片交换测试/图片交换测试_001.png)

另一个图片：
![diagram](/assets/images/posts/2025/2025-01-27-图片交换测试/图片交换测试_002.jpg)
```

**步骤4: 文件系统结果**
```
blog-repo/
├── _posts/
│   └── 2025-01-27-图片交换测试.md
└── assets/images/posts/
    └── 2025/
        └── 2025-01-27-图片交换测试/
            ├── 图片交换测试_001.png
            └── 图片交换测试_002.jpg
```

## 特殊情况处理

### 1. 图片文件未找到

- **处理方式**: 保留原始引用格式，记录警告日志
- **日志信息**: "Image not found: {filename}"

### 2. 重复图片引用

- **处理方式**: 复用已处理的图片，使用相同的重命名文件
- **编号规则**: 不重复计数，引用相同的编号

### 3. 特殊字符处理

#### 文件名清理规则

- **移除字符**: `<>:"/\|?*`
- **替换规则**: 
  - 空格 → 连字符 (`-`)
  - 多个连续连字符 → 单个连字符
  - 开头/结尾连字符 → 移除

#### 示例清理

| 原始标题 | 清理后 |
|----------|--------|
| `"Hello World!"` | `Hello-World` |
| `C++ 学习笔记 (第一章)` | `C-学习笔记-第一章` |
| `API/REST 接口设计` | `API-REST-接口设计` |

### 4. 中文字符支持

- **文件名**: 完全支持中文字符
- **路径**: 支持中文目录名和文件名
- **URL编码**: Jekyll 自动处理 URL 编码

## 系统配置

### GitHub Actions 配置

```yaml
# 相关配置参数
env:
  IMAGE_COUNTER_DIGITS: 3  # 图片编号位数
  SUPPORTED_FORMATS: "png,jpg,jpeg,gif,svg,webp"  # 支持的图片格式
  BASE_IMAGE_PATH: "/assets/images/posts"  # 基础图片路径
```

### JavaScript 处理脚本

```javascript
// 关键配置
const IMAGE_COUNTER_DIGITS = 3;
const SUPPORTED_IMAGE_EXTENSIONS = ['.png', '.jpg', '.jpeg', '.gif', '.svg', '.webp'];
const IMAGE_BASE_PATH = '/assets/images/posts';
```

## 验证和测试

### 转换验证清单

- [ ] 图片文件成功复制到目标目录
- [ ] 图片文件按规则重命名
- [ ] Markdown 中的图片引用路径正确更新
- [ ] 目录结构符合规范
- [ ] 图片编号连续且唯一
- [ ] 特殊字符正确处理
- [ ] 中文字符正常显示

### 测试用例

1. **基础转换测试**: 简单的 Wiki 链接转换
2. **多图片测试**: 包含多个图片的文章
3. **特殊字符测试**: 包含特殊字符的文件名和标题
4. **中文支持测试**: 中文标题和文件名
5. **路径变体测试**: 不同的图片引用路径格式
6. **错误处理测试**: 图片文件不存在的情况

## 维护说明

### 规则更新

当需要修改转换规则时，需要同步更新：

1. **GitHub Actions 工作流**: `.github/workflows/sync-blog-posts.yml`
2. **处理脚本**: `.github/scripts/process-blog-posts.js`
3. **文档**: 本规则文档
4. **README**: 两个仓库的 README 文件

### 兼容性考虑

- **向后兼容**: 新规则应兼容现有的图片引用
- **渐进迁移**: 支持新旧格式并存的过渡期
- **错误恢复**: 提供回滚机制和错误修复方案

---

**文档版本**: v1.0  
**最后更新**: 2025-01-27  
**维护者**: xiaolitongxue666